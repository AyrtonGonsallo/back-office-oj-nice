{% extends "base.html" %}

{% block title %}Accueil{% endblock %}

{% block content %}
 <div class="row">
     <div class="col-2">
     </div>
     <div class="col-sm-8 col-12">
         <div style="border-bottom: black 3px solid; margin-bottom: 50px;">
            <div style="display:flex;justify-content: space-between;">
                <div class="text-left">
                  <h1>Historique des emails</h1>
                </div>
              </div>

         </div>

        {% from 'bootstrap5/table.html' import render_table %}

         <h3>Liste des emails</h3>

        <form method="get" class="mb-3 d-flex">
            <input type="text" name="search_emails" value="{{ search_emails }}" class="form-control me-2" placeholder="Rechercher...">
            <button class="btn btn-primary">Rechercher</button>
        </form>

        <table class="table table-bordered table-hover">
            <thead>
                <tr>
                    {% set col_labels = {
                        'dateEnvoi': 'Date d\'envoi',
                        'objet': 'Objet',
                        'adherentNom': 'Destinataire',
                        'adherentEmail': 'Email',
                        'coursNom': 'Cours',
                        'totalAbscences': 'Total absences',
                        'contenu': 'Contenu'
                    } %}

                    {% for col in ['dateEnvoi', 'objet', 'adherentNom', 'adherentEmail', 'coursNom', 'totalAbscences'] %}
                        <th>
                            <a href="?search_emails={{ search_emails }}&sort_emails={{ col }}&direction_emails={{ 'asc' if direction_emails == 'desc' else 'desc' }}">
                                {{ col_labels[col] }}
                            </a>
                        </th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for email in historique_des_emails %}
                    <tr>
                        <td>{{ email.dateEnvoi | datetimeformat }}</td>
                        <td>{{ email.objet }}</td>
                        <td>{{ email.adherentNom }}</td>
                        <td>{{ email.adherentEmail }}</td>
                        <td>{{ email.coursNom }}</td>
                        <td>{{ email.totalAbscences }}</td>

                    </tr>
                {% endfor %}
            </tbody>
        </table>

       <nav>
          <ul class="pagination">
            {% for p in range(1, pagination.pages + 1) %}
              <li class="page-item {% if p == pagination.page %}active{% endif %}">
                <a class="page-link" href="?page={{ p }}&search_emails={{ search_emails }}&sort_emails={{ sort_emails }}&direction_emails={{ direction_emails }}">{{ p }}</a>
              </li>
            {% endfor %}
          </ul>
        </nav>



        </div>
     <div class="col-2">
     </div>
</div>

{% endblock %}
